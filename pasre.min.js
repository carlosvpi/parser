const L='length',MATCH=(e=>(t,...r)=>{const o=t.match(e);return o&&0===o.index?[["MATCH",o[0]],t.slice(o[0][L])]:[["MATCH",null],t]}),LITERAL=(e=>(t,...r)=>0===t.indexOf(e)?[["LITERAL",e],t.slice(e[L])]:[["LITERAL",null],t]),CONCAT=((...e)=>(t,...r)=>{let o,n,l,s=[];const E=t;for(let T=0;T<e[L];T++){if([[l,o],n]=e[T](t,...r),null===o)return[["CONCAT",null],E];t=n,s.push([l,o])}return[["CONCAT",s],t]}),DISJUNCTION=((...e)=>(t,...r)=>{let o,n,l;for(let s=0;s<e[L];s++)if([[l,o],n]=e[s](t,...r),o)return[["DISJUNCTION",[l,o]],n];return[["DISJUNCTION",null],t]}),OPTION=(e=>(t,...r)=>{const[[o,n],l]=e(t,...r);return n?[["OPTION",[o,n]],l]:[["OPTION",""],t]}),CLOSURE=(e=>(t,...r)=>{let o,[[n,l],s]=e(t,...r),E=[];for(;l;)E.push([n,l]),n=(o=e(s,...r))[0][0],l=o[0][1],s=o[1];return[["CLOSURE",E],s]}),REPETITION=((e,t)=>(r,...o)=>{let n,l,s,E=[];for(let T=0;T<e;T++){if([[n,l],s]=t(r,...o),!l)return[["REPETITION",null],r];r=s,E.push([n,l])}return[["REPETITION",E],r]}),EXCEPTION=((e,t)=>(r,...o)=>{const[[n,l],s]=e(r,...o),[[E,T]]=t(r,...o);return!l||T?[["EXCEPTION",null],r]:[["EXCEPTION",l],s]}),EXPECT=((e,t,r=(e=>[["EXPECT",null],e]))=>(o,{original:n=o,errors:l=[],...s})=>{const E=e(o,{original:n,errors:l,...s});if(null===E[0][1]){const e=""===o?"end of input":`'${o.slice(0,20).split("\n").join("\\n")}...'`,s=""===o?n.split("\n"):n.slice(0,n.indexOf(o)).split("\n"),E=s[L],T=s[E-1][L];return l.push(`âœ˜ ${E}:${T} | Expected '${t}', got ${e}`),r(o)}return E}),parser=module.exports.parser=((e={})=>t=>{const r=[],o=EBNF(t,{original:t,grammarErrors:r,...e});if(r[L])throw new Error({errors:r,grammar:o});const n=(e=>e)(o);return(e,t)=>{const r=[],o=n(e,{original:e,errors:r,...t});if(!Array.isArray(o))throw new Error({errors:"Unexpected error found while parsing. Please, report it to https://github.com/carlosvpi/pasre/issues"});const[l,s]=o;if(r[L])throw new Error({errors:r,tree:l,rest:s});return{tree:l,rest:s}}}),WS=((...e)=>{const[[t,r],o]=MATCH(/([\ \n\t]|\(\*.*\*\))/)(...e);return[["WS",!!r||null],o]}),WSs=((...e)=>{const[[t,r],o]=CLOSURE(WS)(...e);return[["WSs",!0],o]}),NT=((...e)=>{const[[t,r],o]=CONCAT(MATCH(/[a-zA-Z_][a-zA-Z0-9_]*/),WSs)(...e);return[["NT",r&&r[0]&&r[0][1]],o]}),Conc=((e,t={})=>{const[[r,o],n]=DISJUNCTION(NT,CONCAT(MATCH(/[0-9]+/),WSs,EXPECT(LITERAL("*"),"*"),WSs,NT),CONCAT(LITERAL('"'),MATCH(/[^\"]*/),EXPECT(LITERAL('"'),'"'),WSs),CONCAT(LITERAL("'"),MATCH(/[^\']*/),EXPECT(LITERAL("'"),"'"),WSs),CONCAT(LITERAL("/"),MATCH(/[^\/]*/),EXPECT(LITERAL("/"),"/"),WSs),CONCAT(LITERAL("["),WSs,Exp,EXPECT(LITERAL("]"),"]"),WSs),CONCAT(LITERAL("{"),WSs,Exp,EXPECT(LITERAL("}"),"}"),WSs),CONCAT(LITERAL("("),WSs,Exp,EXPECT(LITERAL("("),")"),WSs),CONCAT(LITERAL("?"),EXPECT(t.special||(e=>e),"special rule"),EXPECT(LITERAL("?"),"?"),WSs))(e,t),l=null===o?"Expression":"NT"===o[0]?"NT":"LITERAL"===o[1][2][0]&&"*"===o[1][2][1]?"Multiplication":"LITERAL"===o[1][0][0]&&'"'===o[1][0][1]?"DblQuote":"LITERAL"===o[1][0][0]&&"'"===o[1][0][1]?"SglQuote":"LITERAL"===o[1][0][0]&&"/"===o[1][0][1]?"Regex":"LITERAL"===o[1][0][0]&&"["===o[1][0][1]?"Option":"LITERAL"===o[1][0][0]&&"{"===o[1][0][1]?"Repetition":1;return[[l,"Expression"===l?null:"NT"===l?o[1]:"Multiplication"===l?[o[1][0][1],o[1][4][1]]:"DblQuote"===l?o[1][1][1]:"SglQuote"===l?o[1][1][1]:"Regex"===l?o[1][1][1]:"Option"===l?o[1][2]:"Repetition"===l?o[1][2]:1],n]}),Xcep=((...e)=>{const[[t,r],o]=CONCAT(Conc,CLOSURE(Conc))(...e);return[["Concatenation",r&&[r[0],...r[1][1]]],o]}),Disj=((...e)=>{const[[t,r],o]=CONCAT(Xcep,OPTION(CONCAT(LITERAL("-"),WSs,EXPECT(Xcep,'Expression after "-"'))))(...e);return[["Exception",r?[["Positive",r[0]],["Negative",r[1]&&r[1][1]&&r[1][1][1]&&r[1][1][1][2]||null]]:null],o]}),Exp=((...e)=>{const[[t,r],o]=CONCAT(Disj,CLOSURE(CONCAT(LITERAL("|"),WSs,EXPECT(Disj,'Expression after "|"'))))(...e);return[["Disjunction",r&&[r[0],...r&&r[1]&&r[1][1]&&r[1][1].map(e=>e&&e[1]&&e[1][2])||[]]],o]}),Rule=((...e)=>{const[[t,r],o]=CONCAT(NT,EXPECT(LITERAL("="),"="),WSs,EXPECT(Exp,'Expression after "="'),EXPECT(LITERAL(";"),";"),WSs)(...e);return[["Rule",r?[["Head",r[0]],["Body",r[3]]]:null],o]}),EBNF=((...e)=>{const[[t,r],o]=CLOSURE(Rule)(...e);return[["EBNF",r],o]}),getRootDefault=(([e])=>e),getChildrenDefault=(([e,t=[]])=>t),depthRun=(({getRoot:e=getRootDefault,getChildren:t=getChildrenDefault}={})=>(function*(r){const o=t(r)||[];yield e(r);for(let e=0;e<o[L];e++)yield*depthRun()(o[e])})),breadthRun=(({getRoot:e=getRootDefault,getChildren:t=getChildrenDefault}={})=>(function*(r){let o,n=[r];for(;n[L];)[o,...n]=n,yield e(o),n=n.concat(t(o)||[])})),reduce=((e,t)=>r=>{let o=void 0===t?r.next().value:t;for(let t of r)o=e(o,t);return o});